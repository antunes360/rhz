"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_memex_memex-project-picker-element_ts"],{87738:(e,t,i)=>{function n(e,t,i=.1){let n=o(e,t,i);if(n&&-1===t.indexOf("/")){let r=e.substring(e.lastIndexOf("/")+1);n+=o(r,t,i)}return n}function r(e){let t=e.toLowerCase().split(""),i="";for(let e=0;e<t.length;e++){let n=t[e],r=n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&");0===e?i+=`(.*)(${r})`:i+=`([^${r}]*?)(${r})`}return RegExp(`${i}(.*?)$`,"i")}function s(e,t,i){if(t){let n=e.innerHTML.trim().match(i||r(t));if(!n)return;let s=!1,l=[];for(let e=1;e<n.length;++e){let t=n[e];t&&(e%2==0?s||(l.push("<mark>"),s=!0):s&&(l.push("</mark>"),s=!1),l.push(t))}e.innerHTML=l.join("")}else{let t=e.innerHTML.trim(),i=t.replace(/<\/?mark>/g,"");t!==i&&(e.innerHTML=i)}}i.d(t,{EW:()=>n,Qw:()=>s,qu:()=>a});let l=new Set([" ","-","_"]);function o(e,t,i=.1){let n=e;if(n===t)return 1;let r=n.length,s=0,o=0;for(let e=0;e<t.length;e++){let a=t[e],c=n.indexOf(a.toLowerCase()),h=n.indexOf(a.toUpperCase()),d=Math.min(c,h),u=d>-1?d:Math.max(c,h);if(-1===u)return 0;s+=.1,n[u]===a&&(s+=.1),0===u&&(s+=.9-i,0===e&&(o=1)),l.has(n.charAt(u-1))&&(s+=.9-i),n=n.substring(u+1,r)}let a=t.length,c=s/a,h=(c*(a/r)+c)/2;return o&&h+i<1&&(h+=i),h}function a(e,t){return e.score>t.score?-1:e.score<t.score?1:e.text<t.text?-1:e.text>t.text?1:0}},19418:(e,t,i)=>{i.r(t),i.d(t,{MemexProjectPickerElement:()=>p});var n,r=i(69567),s=i(87738),l=i(76006),o=i(95141),a=i(58700);function c(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}function h(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=i}}function d(e,t,i){if(!t.has(e))throw TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function u(e,t,i){c(e,t),t.set(e,i)}function f(e,t,i){var n=d(e,t,"set");return h(e,n,i),i}var m=function(e,t,i,n){var r,s=arguments.length,l=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(l=(s<3?r(l):s>3?r(t,i,l):r(t,i))||l);return s>3&&l&&Object.defineProperty(t,i,l),l};let p=(n=new WeakMap,class MemexProjectPickerElement extends HTMLElement{connectedCallback(){this.didLoad(),this.multiselect="true"===this.getAttribute("data-multiselect"),this.recentSrc=this.filterElement.src,this.allSrc=this.all.getAttribute("data-src")||"",this.filterElement.filter=(e,t)=>{if(!t)return!0;let i=e.name.trim().toLowerCase(),n=(0,s.EW)(i,t),r=e.number.toString(),l=(0,s.EW)(t,r),o=(0,s.EW)(r,t),a=Math.max(n,l,o),c=a>0?{score:a,text:i}:null;return c&&this.hashedItemScore.set(e,c),a>0},this.list&&f(this,n,new o.Z(this.list));let e=this.closest("details.select-menu");e&&this.list&&e.addEventListener("toggle",this.toggleProjectMenu.bind(this)),this.filterElement.addEventListener("virtual-filter-input-filtered",()=>this.filterDone()),this.filterElement.input?.addEventListener("keydown",e=>{"Enter"===e.key&&e.preventDefault()})}filterDone(){this.list.sort((e,t)=>{let i=this.hashedItemScore.get(t),n=this.hashedItemScore.get(e);return n||i?n?i?(0,s.qu)(n,i):-1:1:0})}switchMode(){let e=this.filterInput.value.length>0;e&&this.filterElement.src!==this.allSrc?this.switchToAllProjectsMode():e||this.filterElement.src===this.recentSrc||this.switchToRecentProjectMode()}switchToAllProjectsMode(){this.filterElement.src=this.allSrc,this.filterElement.loading="eager",this.isAllProjectsMode=!0}switchToRecentProjectMode(){this.filterElement.src=this.recentSrc,this.filterElement.loading="eager",this.isAllProjectsMode=!1}showAllProjectsBlankslate(){this.blankslateAllProjects.hidden=!1}hideAllProjectsBlankslate(){this.blankslateAllProjects.hidden=!0}showRecentProjectsBlankslate(){this.blankslateRecentProjects.hidden=!1}hideRecentProjectsBlankslate(){this.blankslateRecentProjects.hidden=!0}showBlankslate(){this.isAllProjectsMode?this.showAllProjectsBlankslate():this.showRecentProjectsBlankslate()}hideBlankslate(){this.isAllProjectsMode?this.hideAllProjectsBlankslate():this.hideRecentProjectsBlankslate()}showLoadingIndicator(){this.loadingIndicator.removeAttribute("hidden")}hideLoadingIndicator(){this.loadingIndicator.setAttribute("hidden","true")}willLoad(){this.loading=!0,this.showLoadingIndicator(),this.hideAllProjectsBlankslate(),this.hideRecentProjectsBlankslate(),this.filterElement.reset()}didLoad(){this.loading=!1,this.hideLoadingIndicator()}willRenderItems(){this.loading||(0===this.list.size?this.showBlankslate():this.hideBlankslate())}renderItem(e){let t={number:e.detail.item.number,name:e.detail.item.name,owner:e.detail.item.owner,selected:this.isProjectSelected(e.detail.item)};e.detail.fragment.append(this.createItem(t)),this.renderedProjects.has(t.number)||this.renderedProjects.set(t.number,t)}toggleItem(e){if(!(e.target instanceof HTMLInputElement)||"checkbox"!==e.target.type)return;let t=e.target.closest("[data-project-number]");if(!t)return;let i=parseInt(t.getAttribute("data-project-number")||"",10),n=this.renderedProjects.get(i);if(!n)return;this.multiselect||this.resetSelectionDiff();let r=t.getAttribute("aria-checked")||"";"true"===r?(n.selected=!1,this.selectionDiff[i]=n,t.setAttribute("aria-checked","false")):(n.selected=!0,this.selectionDiff[i]=n,t.setAttribute("aria-checked","true")),this.serializeSelection(),this.multiselect||this.triggerUpdate(e)}resetSelectionDiff(){this.selectionDiff={}}triggerUpdate(e){this.multiselect&&this.filterElement.clear();let t=document.getElementById("js-project-picker-form"),i=t.querySelector("memex-project-picker-interstitial");if(!this.multiselect&&i){i.show(e);return}for(let e of t.elements)if((e.getAttribute("name")||"").indexOf("projects_changes")>-1){(0,a.Bt)(t);return}}serializeSelection(){for(let[e,t]of(this.submitContainer.replaceChildren(),Object.entries(this.selectionDiff)))this.submitContainer.append(this.createSubmitSelection(t))}isProjectSelected(e){return(this.selectionDiff[e.number]??e).selected}toggleProjectMenu(e){let t=e.target;if(!t||"create"===t.getAttribute("data-button-type"))return;let i=e.target;if(i.open)return this.open=!0,this.onMenuOpen();this.open=!1,this.multiselect&&this.triggerUpdate(e)}onMenuOpen(){this.list.update(),!1===this.loading&&0===this.list.size&&this.filterElement.load()}createSubmitSelection(e){return new r.R(this.selectionTemplate,{name:`projects_changes[${e.number.toString()}]`,checked:e.selected,projectNumber:e.number,projectName:e.name,projectOwner:e.owner,type:e.selected?"checkbox":"hidden"},r.XK)}createItem(e){return new r.R(this.itemTemplate,e,r.XK)}constructor(...e){super(...e),u(this,n,{writable:!0,value:void 0}),this.loading=!0,this.isAllProjectsMode=!1,this.recentSrc="",this.allSrc="",this.selectionDiff={},this.hashedItemScore=new Map,this.multiselect=!0,this.renderedProjects=new Map,this.open=!1}});m([l.fA],p.prototype,"filterElement",void 0),m([l.fA],p.prototype,"list",void 0),m([l.fA],p.prototype,"itemTemplate",void 0),m([l.fA],p.prototype,"selectionTemplate",void 0),m([l.fA],p.prototype,"submitContainer",void 0),m([l.fA],p.prototype,"blankslateAllProjects",void 0),m([l.fA],p.prototype,"blankslateRecentProjects",void 0),m([l.fA],p.prototype,"all",void 0),m([l.fA],p.prototype,"filterInput",void 0),m([l.fA],p.prototype,"loadingIndicator",void 0),p=m([l.Ih],p)},58700:(e,t,i)=>{i.d(t,{Bt:()=>s,DN:()=>a,KL:()=>d,Se:()=>o,qC:()=>u,sw:()=>c});var n=i(5582);function r(e,t,i){return e.dispatchEvent(new CustomEvent(t,{bubbles:!0,cancelable:i}))}function s(e,t){t&&(l(e,t),(0,n.j)(t)),r(e,"submit",!0)&&e.submit()}function l(e,t){if(!(e instanceof HTMLFormElement))throw TypeError("The specified element is not of type HTMLFormElement.");if(!(t instanceof HTMLElement))throw TypeError("The specified element is not of type HTMLElement.");if("submit"!==t.type)throw TypeError("The specified element is not a submit button.");if(!e||e!==t.form)throw Error("The specified element is not owned by the form element.")}function o(e,t){if("boolean"==typeof t){if(e instanceof HTMLInputElement)e.checked=t;else throw TypeError("only checkboxes can be set to boolean value")}else{if("checkbox"===e.type)throw TypeError("checkbox can't be set to string value");e.value=t}r(e,"change",!1)}function a(e,t){for(let i in t){let n=t[i],r=e.elements.namedItem(i);r instanceof HTMLInputElement?r.value=n:r instanceof HTMLTextAreaElement&&(r.value=n)}}function c(e){if(!(e instanceof HTMLElement))return!1;let t=e.nodeName.toLowerCase(),i=(e.getAttribute("type")||"").toLowerCase();return"select"===t||"textarea"===t||"input"===t&&"submit"!==i&&"reset"!==i||e.isContentEditable}function h(e){return new URLSearchParams(e)}function d(e,t){let i=new URLSearchParams(e.search),n=h(t);for(let[e,t]of n)i.append(e,t);return i.toString()}function u(e){return h(new FormData(e)).toString()}},5582:(e,t,i)=>{function n(e){let t=e.closest("form");if(!(t instanceof HTMLFormElement))return;let i=r(t);if(e.name){let n=e.matches("input[type=submit]")?"Submit":"",r=e.value||n;i||((i=document.createElement("input")).type="hidden",i.classList.add("js-submit-button-value"),t.prepend(i)),i.name=e.name,i.value=r}else i&&i.remove()}function r(e){let t=e.querySelector("input.js-submit-button-value");return t instanceof HTMLInputElement?t:null}i.d(t,{j:()=>n,u:()=>r})}}]);
//# sourceMappingURL=app_components_memex_memex-project-picker-element_ts-f42bc3e06088.js.map